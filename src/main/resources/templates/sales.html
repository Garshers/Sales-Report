<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Sales Report</title>
    <link rel="stylesheet" type="text/css" href="/css/salesStyle.css">
</head>
<body>
    <h1>Sales Report</h1>
    
    <!-- Table displaying sales data -->
    <table id="saleStockTable">
        <thead>
            <tr>
                <th>Product ID <button id="sortBtn0" class="sortBtn" onclick="sortTable('saleStockTable', 0)">Sort</button></th>
                <th>Product Name<button id="sortBtn1" class="sortBtn" onclick="sortTable('saleStockTable', 1)">Sort</button></th>
                <th>Quantity Sold <button id="sortBtn2" class="sortBtn" onclick="sortTable('saleStockTable', 2)">Sort</button></th>
                <th>Total Profit <button id="sortBtn3" class="sortBtn" onclick="sortTable('saleStockTable', 3)">Sort</button></th>
            </tr>
        </thead>
        <tbody>
            <!-- Iterate over the combined sales and stock list and display details -->
            <tr th:each="saleStock : ${saleStockList}">
                <td th:text="${saleStock.productId}"></td>
                <td th:text="${saleStock.productName}"></td>
                <td th:text="${saleStock.quantitySold}"></td>
                <td th:text="${saleStock.totalProfit}"></td>
            </tr>
        </tbody>
    </table>

    <!-- Section displaying sales person and their sales -->
    <table id="salesPersonsTable">
        <thead>
            <tr>
                <th>Sales Person<button id="sortBtn0" class="sortBtn" onclick="sortTable('salesPersonsTable', 0)">Sort</button></th>
                <th>Total Profit<button id="sortBtn1" class="sortBtn" onclick="sortTable('salesPersonsTable', 1)">Sort</button></th>
            </tr>
        </thead>
        <tbody>
            <!-- Iterate through salesperson profits -->
            <tr th:each="sPProfits : ${salesPersonProfits}">
                <td th:text="${sPProfits.key}"></td>
                <td th:text="${sPProfits.value}"></td>
            </tr>
        </tbody>
    </table>

    <!-- Section displaying every single individual sale -->
    <h2>Individual Sales</h2>
    <table id="salesTable">
        <thead>
            <tr>
                <th>Sale ID<button id="sortBtn0" class="sortBtn" onclick="sortTable('salesTable', 0)">Sort</button></th>
                <th>Product ID<button id="sortBtn1" class="sortBtn" onclick="sortTable('salesTable', 1)">Sort</button></th>
                <th>Product<button id="sortBtn2" class="sortBtn" onclick="sortTable('salesTable', 2)">Sort</button></th>
                <th>Price<button id="sortBtn3" class="sortBtn" onclick="sortTable('salesTable', 3)">Sort</button></th>
                <th>Sales Person ID<button id="sortBtn4" class="sortBtn" onclick="sortTable('salesTable', 4)">Sort</button></th>
                <th>Sales Person<button id="sortBtn5" class="sortBtn" onclick="sortTable('salesTable', 5)">Sort</button></th>
            </tr>
        </thead>
        <tbody>
            <!-- Iteracja przez listÄ™ -->
            <tr th:each="sale : ${saleList}">
                <td th:text="${sale['saleId']}"></td>
                <td th:text="${sale['productId']}"></td>
                <td th:text="${sale['productTypeName']}"></td>
                <td th:text="${sale['price']}"></td>
                <td th:text="${sale['salesPersonId']}"></td>
                <td th:text="${sale['salesPersonNameSurname']}"></td>
            </tr>
        </tbody>
        <!--<thead>
            <tr>
                <th>Sale ID</th>
                <th>Product ID</th>
                <th>Price</th>
                <th>Product Type</th>
                <th>Sales Person ID</th>
                <th>Sales Person Name</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="salePerson : ${salePersonsWithSaleDTOList}">
                <td th:text="${salePerson.saleId}"></td>
                <td th:text="${salePerson.productId}"></td>
                <td th:text="${salePerson.price}"></td>
                <td th:text="${salePerson.productTypeName}"></td>
                <td th:text="${salePerson.salesPersonId}"></td>
                <td th:text="${salePerson.salesPersonNameSurname}"></td>
            </tr>
        </tbody>-->
    </table>

    <!-- Link to navigate to the charts page -->
    <a href="/charts">Go to chart page</a>
</body>
</html>

<script>
    // Function to sort the table
    function sortTable(tableId, n) {
        var table = document.getElementById(tableId).getElementsByTagName("tbody")[0]; // Select the table body
        var rows = Array.from(table.rows); // Convert the rows into an array
        var ascending = document.getElementById("sortBtn" + n).classList.contains("ascending"); // Check if the button for the current column is in ascending state
        
        // Sort the rows based on the content of the specified column (n)
        var sortedRows = rows.sort(function(a, b) {
            var aText = a.cells[n].innerText; // Get the text content of the cells in the specified column
            var bText = b.cells[n].innerText;
            
            function isNumeric(value) {
                return !isNaN(value) && value.trim() !== ''; // Checks if the value is a valid number
            }
    
            // Check if the column contains numeric values and convert if necessary
            if (isNumeric(aText) && isNumeric(bText)) {
                aText = parseFloat(aText.replace(/[^\d.-]/g, '')); // Remove non-numeric characters
                bText = parseFloat(bText.replace(/[^\d.-]/g, ''));
            }

            // Compare values and return the result based on the current sorting order
            if (ascending) {
                return aText > bText ? 1 : -1;
            } else {
                return aText < bText ? 1 : -1;
            }
        });
    
        // Rebuild the table with the sorted rows
        table.innerHTML = "";
        sortedRows.forEach(function(row) {
            table.appendChild(row);
        });
    
        // Toggle the button's state to reflect the current sorting order (ascending/descending)
        var buttons = document.querySelectorAll(".sortBtn");
        buttons.forEach(function(button) {
            button.classList.remove("ascending", "descending");
        });
        document.getElementById("sortBtn" + n).classList.toggle("ascending", !ascending);
        document.getElementById("sortBtn" + n).classList.toggle("descending", ascending);
    }
</script>   